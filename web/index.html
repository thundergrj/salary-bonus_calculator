<!DOCTYPE html>
<html>
<head>
<title>Salary&Bonus Calculator</title>
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery.min.js"></script>
<!-- Custom Theme files -->
<!--theme-style-->
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />	
<!--//theme-style-->
<meta charset="UTF-8" />
<meta http-equiv="refresh"> 
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<script src="js/modernizr.custom.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!---->
<link href='https://fonts.googleapis.com/css?family=Raleway:400,200,100,300,500,600,700,800,900' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,300italic,700' rel='stylesheet' type='text/css'>
<!-- start-smoth-scrolling -->
		<script type="text/javascript" src="js/move-top.js"></script>
		<script type="text/javascript" src="js/easing.js"></script>
		<script type="text/javascript">
	  		jQuery(document).ready(function($) {
				$(".scroll").click(function(event){		
					event.preventDefault();
					$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
				});
			});
		</script>
	<!-- start-smoth-scrolling -->
<link href="css/styles.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/component.css" />
	<!-- animation-effect -->
<link href="css/animate.min.css" rel="stylesheet"> 
<script src="js/wow.min.js"></script>
<script>
 new WOW().init();
</script>
<!-- //animation-effect -->
</head>


<style>
{
	input{
        width:300px;
        height:30px;
        border-radius:10px;
        border:2px solid gray;
    }
    button{
        border-radius: 10px;
    }
}
</style>


<body>
 <div class="header">
	<div class="container">
		<div class="logo animated wow pulse" data-wow-duration="1000ms" data-wow-delay="500ms">
			<h1><a href="index.html">Homepage</a></h1>
		</div>
		<div class="nav-icon">		
			<a href="#" class="navicon"></a>
				<div class="toggle">
					<ul class="toggle-menu">
						<li><a class="active" href="index.html">Home</a></li>
						<li><a  href="#salary">Salary</a></li>
						<li><a  href="#bonus">Bonus</a></li>
						<li><a  href="#follow">Follow Us</a></li>
					</ul>
				</div>
			<script>
			$('.navicon').on('click', function (e) {
			  e.preventDefault();
			  $(this).toggleClass('navicon--active');
			  $('.toggle').toggleClass('toggle--active');
			});
			</script>
		</div>
	<div class="clearfix"></div>
	</div>
	<!-- start search-->	
		<div class="banner">
			<p class="animated wow fadeInLeft" data-wow-duration="1000ms" data-wow-delay="500ms">Now support Beijing, and other cities would be added soon!</p>
			<label></label>
			<h4 class="animated wow fadeInTop" data-wow-duration="1000ms" data-wow-delay="500ms">Welcome To Salary & Bonus Calculator</h4>
			<a class="scroll down" href="#content-down"><img src="images/down.png" alt=""></a>
		</div>
</div>
<!--content-->
<div class="content" id="content-down">
	<div class="content-top-top">
		<div class="container">
			<div class="content-top">
				<div class="col-md-4 content-left animated wow fadeInLeft">
					<h3 id="salary">Salary</h3>
					<label><i class="glyphicon glyphicon-menu-up"></i></label>
					<span>Submit your salary before taxing and see the results</span>
					<br>
					<br>
					<label for="inputParameter1">
					</label>
					<input id="inputParameter1" style="resize:both;text-align: center;width: 300px;height: 30px;border-radius: 5px;border:2px solid grey" placeholder="Salary">
					<br>
					<br>
                    <button class="md-trigger" data-modal="modal-1" id="buttonCallTest1" class="btn btn-block" style="resize:both;text-align: center;width: 60px;height: 30px;border-radius: 5px;border:2px solid grey">Submit</button>
                    <button class="md-trigger" data-modal="modal-1" id="buttonCallDapp1" class="btn btn-block" style="resize:both;position: absolute;left:255px;width: 60px;height: 30px;border-radius: 5px;border:2px solid grey">Results</button>
				</div>
				<div class="col-md-8 content-right animated wow fadeInRight">
					<p id="txResult1" style="text-align: center;"></p>
					<br>
					<canvas id="myCanvas_1" width="600" height="300" style="position:absolute;left:100px;border:0px solid #c3c3c3"></canvas>
				</div>
			</div> 
		</div>
	</div>
</div>
<!--services-->
<div class="services">
	<div class="container">
		<div class="services-top">		
			<div class="col-md-8 services-right animated wow fadeInLeft">
				<p id="txResult2" style="text-align: center;"></p>
				<br>
				<canvas id="myCanvas_2" width="600" height="300" style="position:absolute;right:100px;border:0px solid #c3c3c3">
				</canvas>
			</div>
			<div class="col-md-4 services-left animated wow fadeInRight">
				<h3 id="bonus">Bonus</h3>
				<label><i class="glyphicon glyphicon-menu-up"></i></label>
				<span>Submit your bonus before taxing and see the results</span>
				<br>
				<br>
				<label for="inputParameter2">
					</label>
					<input id="inputParameter2" style="resize:both;text-align: center;width: 300px;height: 30px;border-radius: 5px;border:2px solid grey" placeholder="Bonus">
					<br>
					<br>
                    <button class="md-trigger" data-modal="modal-1" id="buttonCallTest2" class="btn btn-block" style="resize:both;text-align: center;width: 60px;height: 30px;border-radius: 5px;border:2px solid grey">Submit</button>
                    <button class="md-trigger" data-modal="modal-1" id="buttonCallDapp2" class="btn btn-block" style="resize:both;position: absolute;right:255px;width: 60px;height: 30px;border-radius: 5px;border:2px solid grey">Results</button>
			</div>
			<div class="clearfix"></div>
		</div>
	</div>
</div>

<!--footer-->
	<div class="footer">
		<div class="container">
			<div class="footer-head">
				<div class="col-md-8 footer-top animated wow fadeInRight" data-wow-duration="1000ms" data-wow-delay="500ms">
					<ul class=" in">
						<li><a href="index.html">Home</a></li>
					</ul>					
						<span>Please wait for more functions!</span>
				</div>
				<div class="col-md-4 footer-bottom  animated wow fadeInLeft" data-wow-duration="1000ms" data-wow-delay="500ms">
					<h2 id="follow">Follow Us</h2>
					<br>
					<br>
					<br>
					<ul class="social-ic">
						<li><a href="https://github.com/thundergrj/salary-bonus_calculator.git">Github</a></li>
						<br>
						<li><a href="https://github.com/ChengOrangeJu/WebExtensionWallet.git">Nebulas Extension Wallet</a></li>
					</ul>

				</div>
			<div class="clearfix"> </div>
					
			</div>
		</div>
	</div>		
	<!--//footer-->
<script>
    document.getElementById("buttonCallTest1").addEventListener("click",function(){
        console.log("********* call smart contract \"sendTransaction\" *****************")
        var to = "n22QmBBcLnL7nRgEMo3oufnTYqynpyLYc9B"
        var func = "Salary"
        var para = "[\"" + document.getElementById("inputParameter1").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":para
                }
            },
            "method": "neb_sendTransaction"
        }, "*");
    })

    document.getElementById("buttonCallDapp1").addEventListener("click",function(){
        console.log("********* call smart contract by \"call\" *****************")
        var to = "n22QmBBcLnL7nRgEMo3oufnTYqynpyLYc9B";
        var func = "dataOfSalary";
        //var para = "[\"" + document.getElementById("inputParameter").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":""
                }
            },
            "method": "neb_call"
        }, "*");
    })

    document.getElementById("buttonCallTest2").addEventListener("click",function(){
        console.log("********* call smart contract \"sendTransaction\" *****************")
        var to = "n22QmBBcLnL7nRgEMo3oufnTYqynpyLYc9B"
        var func = "Bonus"
        var para = "[\"" + document.getElementById("inputParameter2").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":para
                }
            },
            "method": "neb_sendTransaction"
        }, "*");
    })

    document.getElementById("buttonCallDapp2").addEventListener("click",function(){
        console.log("********* call smart contract by \"call\" *****************")
        var to = "n22QmBBcLnL7nRgEMo3oufnTYqynpyLYc9B";
        var func = "dataOfBonus";
        //var para = "[\"" + document.getElementById("inputParameter").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":""
                }
            },
            "method": "neb_call"
        }, "*");
    })

    // listen message from contentscript
    window.addEventListener('message', function(e) {
        // e.detail contains the transferred data (can
        console.log("recived by page:" + e + ", e.data:"+ JSON.stringify(e.data));
        if(!!e.data.data.account){
            document.getElementById("accountAddress").innerHTML= "Account address: " + e.data.data.account;
        }
        if(!!e.data.data.receipt){
            //document.getElementById("txResult").innerHTML = "Transaction Receipt\n" +  JSON.stringify(e.data.data.receipt,null,'\t');
            //document.getElementById("txResult1").innerHTML = "here should be cut"
        }
        if(!!e.data.data.neb_call){
          var s = JSON.stringify(e.data.data.neb_call);
          var m = JSON.parse(s);
          var bmiArray = new Array();
          bmiArray = m.result;
          var bmi = JSON.parse(bmiArray);
          var myObj = eval(bmi);
          var canvasName;
          var color_arr;
          var text_arr;
          if(myObj.length > 2)
          {
            canvasName = "myCanvas_1";
            color_arr = ["#00EC00", "#019858", "#707038", "#8E8E8E","#BB3D00","#D26900"];
            text_arr = ["after tax salary", "salary tax", "endowment", "medical","unemployment","housing provident fund"];
          }
          else
          {
            canvasName = "myCanvas_2";
            color_arr = ["#00EC00", "#019858"];
            text_arr = ["after tax salary", "salary tax"];
          }


          //var obj = eval(s);
          //var obj = JSON.parse(s);
          //var s = JSON.stringify(e.data.data.neb_call);
         // s =  e.data.data.neb_call;
          //var payOrder = s.get(result);
          document.getElementById("txResult1").innerHTML = "<strong>Your salary</strong>：" + myObj;
          //document.getElementById("txResult2").innerHTML = "<strong>Diet</strong>：" + text2;
          //document.getElementById("txResult3").innerHTML = "<strong>Exercise</strong>：" + text3;
        //document.getElementById("txResult").innerHTML = "return of call\n" +  JSON.stringify(e.data.data.neb_call,null,'\t');


        //绘制饼状图
        var data_arr = new Array();
        var sum=0;
        for(i=0;i<myObj.length;i++)
        {
            sum+=myObj[i];
        }
        for(i=0;i<myObj.length;i++)
        {
            var percentage = (myObj[i]/sum).toFixed(4);
            data_arr.push(percentage);
        }
        var canv = document.getElementById(canvasName);
        var ctx = canv.getContext('2d');
        var width = canv.width;
        var height = canv.height; 
        ctx.clearRect(0,0,width,height);
        var radius = height / 2 - 20; //半径
        var ox = radius + 20, oy = radius + 20; //圆心  
        var width = 30, height = 10; //图例宽和高  
        var posX = ox * 2 + 20, posY = 30;   //  
        var textX = posX + width + 5, textY = posY + 10;  
        var startAngle = 0; //起始弧度  
        var endAngle = 0;   //结束弧度
        for (var i = 0; i < data_arr.length; i++)  
        {  
            //绘制饼图  
            endAngle = endAngle + data_arr[i] * Math.PI * 2; //结束弧度  
            ctx.fillStyle = color_arr[i];  
            ctx.beginPath();  
            ctx.moveTo(ox, oy); //移动到到圆心  
            ctx.arc(ox, oy, radius, startAngle, endAngle, false);  
            ctx.closePath();  
            ctx.fill();  
            startAngle = endAngle; //设置起始弧度  
            //绘制比例图及文字  
            ctx.fillStyle = color_arr[i];  
            ctx.fillRect(posX, posY + 20 * i, width, height);  
            ctx.moveTo(posX, posY + 20 * i);  
            ctx.font = 'bold 12px 微软雅黑';    //斜体 30像素 微软雅黑字体  
            ctx.fillStyle = "#000000"; //"#000000";  
            var percent = text_arr[i] + "：" + myObj[i] + "RMB";  
            ctx.fillText(percent, textX, textY + 20 * i);  
        }  
        }
    });
</script>
</body>
</html>